'use strict';var _regenerator=require('babel-runtime/regenerator'),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator'),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_keys=require('babel-runtime/core-js/object/keys'),_keys2=_interopRequireDefault(_keys),_typeof2=require('babel-runtime/helpers/typeof'),_typeof3=_interopRequireDefault(_typeof2),_assign=require('babel-runtime/core-js/object/assign'),_assign2=_interopRequireDefault(_assign),_classCallCheck2=require('babel-runtime/helpers/classCallCheck'),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_axios=require('axios'),_axios2=_interopRequireDefault(_axios);exports.__esModule=!0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var Http=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=b.conf,d=void 0===c?{}:c,e=b.format,f=void 0===e?{errno:'errno',errmsg:'errmsg',token:'token',data:'data'}:e,g=b.hosts,h=void 0===g?{}:g,i=b.trim;(0,_classCallCheck3.default)(this,a);this.conf=(0,_assign2.default)({timeout:3e4,responseType:'json',headers:{"X-Requested-With":'XMLHttpRequest'}},d),this.hosts=h,this.format=f,this.dataDf={},this.dataDf[f.errno]='',this.dataDf[f.errmsg]='',this.dataDf[f.data]={},this.trim=void 0!==i&&i,this.axios=_axios2.default.create(this.conf)}return a.prototype.stringParse=function stringParse(a){if('string'==typeof a)try{a=JSON.parse(a)}catch(b){a=(0,_assign2.default)({},this.dataDf)}return a},a.prototype.serialize=function serialize(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'?',d='';return'object'===('undefined'==typeof a?'undefined':(0,_typeof3.default)(a))&&(0,_keys2.default)(a).forEach(function(e){var f=a[e];b.trim&&f&&'function'==typeof f.trim?f=f.trim():'','undefined'!=typeof f&&'undefined'!==f&&''!==f&&('?'===c?d+='&'+e+'='+f:d+='/'+e+'/'+f)}),d.replace(/^&/,'?')},a.prototype.processUrl=function processUrl(a){for(var b,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'?',e=(0,_keys2.default)(this.hosts),f=a,g=0;g<e.length;g+=1)if(b=e[g],0===a.indexOf('/'+b+'/')){f=a.replace('/'+b,this.hosts[b]),f=''+f+this.serialize(c,d);break}return f},a.prototype.trimHandle=function trimHandle(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,_keys2.default)(a).forEach(function(b){var c=a[b];c&&'function'==typeof c.trim?a[b]=c.trim():''}),a},a.prototype.errHandle=function errHandle(a){var b={};return b[this.format.errno]=600,b[this.format.errmsg]=a.message,(0,_assign2.default)({},this.dataDf,b)},a.prototype.resultHandle=function resultHandle(a){var b=this.format.token,c=a.config&&a.config.headers?a.config.headers[b]:'',d=a.headers?a.headers[b]:'',e='';d&&d!==c&&(e=d);var f={};return 200===a.status?f=this.stringParse(a.data):(f[this.format.errno]=a.status,f[this.format.errmsg]=a.statusText),e&&(f[b]=e),(0,_assign2.default)({},this.dataDf,a,f)},a.prototype.get=function(){var a=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=void 0,a.prev=1,a.next=4,this.axios.get(this.processUrl(b,d),e);case 4:c=a.sent,a.next=12;break;case 7:if(a.prev=7,a.t0=a['catch'](1),a.t0.response){a.next=11;break}return a.abrupt('return',this.errHandle(a.t0));case 11:c=a.t0.response;case 12:return a.abrupt('return',this.resultHandle(c));case 13:case'end':return a.stop();}},a,this,[[1,7]])}));return function get(){return a.apply(this,arguments)}}(),a.prototype.post=function(){var a=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=arguments[2];return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=void 0,a.prev=1,a.next=4,this.axios.post(this.processUrl(b),this.trim?this.trimHandle(d):d,e);case 4:c=a.sent,a.next=12;break;case 7:if(a.prev=7,a.t0=a['catch'](1),a.t0.response){a.next=11;break}return a.abrupt('return',this.errHandle(a.t0));case 11:c=a.t0.response;case 12:return a.abrupt('return',this.resultHandle(c));case 13:case'end':return a.stop();}},a,this,[[1,7]])}));return function post(){return a.apply(this,arguments)}}(),a.prototype.put=function(){var a=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=arguments[2];return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=void 0,a.prev=1,a.next=4,this.axios.put(this.processUrl(b),this.trim?this.trimHandle(d):d,e);case 4:c=a.sent,a.next=12;break;case 7:if(a.prev=7,a.t0=a['catch'](1),a.t0.response){a.next=11;break}return a.abrupt('return',this.errHandle(a.t0));case 11:c=a.t0.response;case 12:return a.abrupt('return',this.resultHandle(c));case 13:case'end':return a.stop();}},a,this,[[1,7]])}));return function put(){return a.apply(this,arguments)}}(),a.prototype.delete=function(){var a=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=arguments[2];return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=void 0,a.prev=1,a.next=4,this.axios.delete(this.processUrl(b),this.trim?this.trimHandle(d):d,e);case 4:c=a.sent,a.next=12;break;case 7:if(a.prev=7,a.t0=a['catch'](1),a.t0.response){a.next=11;break}return a.abrupt('return',this.errHandle(a.t0));case 11:c=a.t0.response;case 12:return a.abrupt('return',this.resultHandle(c));case 13:case'end':return a.stop();}},a,this,[[1,7]])}));return function _delete(){return a.apply(this,arguments)}}(),a.prototype.patch=function(){var a=(0,_asyncToGenerator3.default)(/*#__PURE__*/_regenerator2.default.mark(function a(b){var c,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=arguments[2];return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=void 0,a.prev=1,a.next=4,this.axios.patch(this.processUrl(b),this.trim?this.trimHandle(d):d,e);case 4:c=a.sent,a.next=12;break;case 7:if(a.prev=7,a.t0=a['catch'](1),a.t0.response){a.next=11;break}return a.abrupt('return',this.errHandle(a.t0));case 11:c=a.t0.response;case 12:return a.abrupt('return',this.resultHandle(c));case 13:case'end':return a.stop();}},a,this,[[1,7]])}));return function patch(){return a.apply(this,arguments)}}(),a}();exports.default=Http;
